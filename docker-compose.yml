# ============================================================
# Salary Perspective — Docker Android Build
#
# Usage:
#   docker compose run --rm build          (first build, generates keystore)
#   docker compose run --rm build          (subsequent builds with saved keystore)
#
# Output:
#   ./output/app-release.aab               (upload this to Google Play)
#   ./output/salary-perspective-release.keystore  (first build only — SAVE THIS!)
#
# Configuration via environment variables (pass with -e):
#   KEYSTORE_PASSWORD   Keystore password        (default: "android")
#   VERSION_CODE        Integer, must increase   (default: 1)
#   VERSION_NAME        Semver for users         (default: "1.0.0")
# ============================================================

services:
  build:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      # Source code — mounted read-only (copied to /build inside container)
      - .:/src:ro
      # Keystore from host (place your .keystore file here)
      - ./keystore:/keystore:ro
      # Output directory for the AAB + generated keystore
      - ./output:/output
    environment:
      - KEYSTORE_PASSWORD=${KEYSTORE_PASSWORD:-android}
      - KEYSTORE_ALIAS=${KEYSTORE_ALIAS:-salary-perspective}
      - VERSION_CODE=${VERSION_CODE:-1}
      - VERSION_NAME=${VERSION_NAME:-1.0.0}
      - APP_ID=${APP_ID:-com.salaryperspective.app}
      - APP_NAME=${APP_NAME:-Salary Perspective}
